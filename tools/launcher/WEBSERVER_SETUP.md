# Web Server Setup Guide

## ğŸ“‹ What You Need on Your Web Server

Your web server (XAMPP at `C:\xampp\htdocs\`) needs these files and structure:

```
C:\xampp\htdocs\
â”œâ”€â”€ WoW\                     # Extracted game folder (REQUIRED)
â”‚   â”œâ”€â”€ Wow.exe
â”‚   â”œâ”€â”€ Data\
â”‚   â”œâ”€â”€ filelist.txt         # File list for launcher (auto-generated)
â”‚   â””â”€â”€ ... (all game files)
â””â”€â”€ patches\
    â”œâ”€â”€ version.txt          # Patch version (timestamp) - AUTO-GENERATED by server
    â””â”€â”€ latest\
        â””â”€â”€ patch-Z.MPQ      # Latest patch file - AUTO-COPIED by server
```

## ğŸ”§ Server-Side Setup

### 1. Configure Server to Copy Patches

In `mod-progressive-systems.conf`:

```ini
# Web Server Path (for launcher auto-updates)
ProgressiveSystems.DBC.WebServerPath = C:/xampp/htdocs
```

**This makes the server automatically:**
- Copy `patches/patch-Z.MPQ` to `C:/xampp/htdocs/patches/latest/patch-Z.MPQ`
- Update `C:/xampp/htdocs/patches/version.txt` with timestamp

### 2. Extract Game Files

**Extract WoW to Web Server:**
1. Extract your WoW client ZIP to `C:\xampp\htdocs\WoW\`
2. Structure should be:
   ```
   C:\xampp\htdocs\WoW\
   â”œâ”€â”€ Wow.exe
   â”œâ”€â”€ Data\
   â”‚   â”œâ”€â”€ enUS\
   â”‚   â””â”€â”€ ...
   â””â”€â”€ ... (all game files)
   ```

3. **Generate file list** (optional but recommended):
   ```powershell
   .\tools\create_game_filelist.ps1
   ```
   This creates `C:\xampp\htdocs\WoW\filelist.txt` with all files.
   Launcher uses this to know what files to download.

### 3. Start XAMPP Apache

1. Open XAMPP Control Panel
2. Click "Start" for Apache
3. Verify: `http://localhost/` works

### 4. Generate File List

Run the PowerShell script to create file list:
```powershell
.\tools\create_game_filelist.ps1
```

This creates `C:\xampp\htdocs\WoW\filelist.txt` with all game files.

### 5. Test URLs

Test these URLs in browser:

- âœ… `http://localhost/WoW/` - Should show directory listing or 403 (normal)
- âœ… `http://localhost/WoW/filelist.txt` - Should show file list
- âœ… `http://localhost/WoW/Wow.exe` - Should download executable
- âœ… `http://localhost/patches/version.txt` - Should show timestamp
- âœ… `http://localhost/patches/latest/patch-Z.MPQ` - Should download MPQ

## ğŸ“ File Structure Details

### `patches/version.txt`
- **Format**: Unix timestamp (e.g., `1704067200`)
- **Auto-generated**: Server updates this when patch is created
- **Purpose**: Launcher compares this with local patch version

### `patches/latest/patch-Z.MPQ`
- **Source**: `patches/patch-Z.MPQ` (generated by server)
- **Auto-copied**: Server copies to web server path
- **Purpose**: Launcher downloads this file

### `WoW/` Folder (Required)
- **Purpose**: Extracted game files for download
- **Location**: `C:\xampp\htdocs\WoW\`
- **Structure**: Full WoW installation structure
- **filelist.txt**: List of all files (generated by script)

### `WoW/filelist.txt` (Optional but Recommended)
- **Purpose**: Tells launcher which files to download
- **Generated by**: `tools/create_game_filelist.ps1`
- **Format**: One file path per line (relative to WoW folder)
- **If missing**: Launcher downloads critical files only

## ğŸ”„ How It Works

### Server Startup:
1. Server generates `patches/patch-Z.MPQ`
2. Server copies to `C:/xampp/htdocs/patches/latest/patch-Z.MPQ`
3. Server updates `C:/xampp/htdocs/patches/version.txt`

### Launcher Startup:
1. Launcher checks `http://localhost/patches/version.txt`
2. Compares with local patch version
3. If newer, downloads `http://localhost/patches/latest/patch-Z.MPQ`
4. Places in `WoW/Data/patch-Z.MPQ`

## ğŸŒ Remote Server Setup

If using remote server (not localhost):

1. **Update launcher config:**
   ```json
   {
       "server_url": "http://your-server-ip",
       "game_zip_url": "http://your-server-ip/WOTLKHD.zip",
       "patch_version_url": "http://your-server-ip/patches/version.txt",
       "patch_download_url": "http://your-server-ip/patches/latest/patch-Z.MPQ"
   }
   ```

2. **Or use Settings dialog** in launcher GUI

3. **Place files on remote server:**
   - Same structure as localhost
   - Ensure Apache/web server is running
   - Check firewall allows HTTP access

## âœ… Verification Checklist

- [ ] XAMPP Apache is running
- [ ] `C:\xampp\htdocs\WoW\` folder exists with game files
- [ ] `C:\xampp\htdocs\WoW\Wow.exe` exists
- [ ] `C:\xampp\htdocs\WoW\filelist.txt` exists (run script to generate)
- [ ] `C:\xampp\htdocs\patches\` folder exists
- [ ] `C:\xampp\htdocs\patches\version.txt` exists (or will be created)
- [ ] `C:\xampp\htdocs\patches\latest\` folder exists
- [ ] `ProgressiveSystems.DBC.WebServerPath` is set in config
- [ ] Server can write to `C:\xampp\htdocs\` (check permissions)
- [ ] Test URLs work in browser

## ğŸš¨ Troubleshooting

### "Could not connect to server"
- Check Apache is running
- Check firewall isn't blocking
- Verify URL in launcher config
- Test URL in browser

### "Patch not found"
- Check `patches/latest/patch-Z.MPQ` exists
- Check server copied patch successfully
- Check file permissions

### "Permission denied"
- Run XAMPP as administrator
- Check folder permissions
- Ensure server can write to `htdocs/patches/`

## ğŸ“ Summary

**You need to:**
1. âœ… Extract WoW to `C:\xampp\htdocs\WoW\`
2. âœ… Run `tools\create_game_filelist.ps1` to generate file list
3. âœ… Set `ProgressiveSystems.DBC.WebServerPath = C:/xampp/htdocs` in config
4. âœ… Start XAMPP Apache
5. âœ… Server auto-generates and copies patches

**Server automatically:**
- âœ… Generates patches
- âœ… Copies to web server
- âœ… Updates version.txt

**Launcher automatically:**
- âœ… Checks for updates
- âœ… Downloads patches
- âœ… Installs to game folder

**ZERO WORK after initial setup!** ğŸ‰

