# Complete Web Server Setup Guide

## üéØ What You Need to Do

This guide shows you exactly what files to put where in your web server so the launcher can communicate with it.

## üìÅ File Structure

Your web server (XAMPP at `C:\xampp\htdocs\`) should have this structure:

```
C:\xampp\htdocs\
‚îú‚îÄ‚îÄ WoW\                           # Extracted game folder (NEW!)
‚îÇ   ‚îú‚îÄ‚îÄ Wow.exe
‚îÇ   ‚îú‚îÄ‚îÄ Data\
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ WOTLKHD.zip                    # Original ZIP (optional, can delete after extraction)
‚îî‚îÄ‚îÄ patches\
    ‚îú‚îÄ‚îÄ version.txt                # Patch version (auto-generated by server)
    ‚îî‚îÄ‚îÄ latest\
        ‚îî‚îÄ‚îÄ patch-Z.MPQ           # Latest patch (symlink or copy)
```

## üîß Step-by-Step Setup

### Step 1: Extract Game to Web Server

**Location:** `C:\xampp\htdocs\WoW\`

**What to do:**
```powershell
# Run extraction script
.\tools\extract_game_to_htdocs.ps1
```

**Or manually:**
1. Place `WOTLKHD.zip` in `C:\xampp\htdocs\`
2. Extract ZIP to `C:\xampp\htdocs\WoW\`
3. Verify `Wow.exe` exists in `C:\xampp\htdocs\WoW\`

**Verify:**
- Folder should be accessible at: `http://localhost/WoW/`
- Test in browser: Open `http://localhost/WoW/Wow.exe` (should download)

### Step 2: Create Patches Directory

**Location:** `C:\xampp\htdocs\patches\`

**What to do:**
```powershell
# Create directory
New-Item -ItemType Directory -Path "C:\xampp\htdocs\patches" -Force
New-Item -ItemType Directory -Path "C:\xampp\htdocs\patches\latest" -Force
```

### Step 3: Setup Server Auto-Copy

**Configure server to copy patches automatically:**

Edit `mod-progressive-systems.conf`:
```ini
# Web Server Path (for launcher auto-updates)
ProgressiveSystems.DBC.WebServerPath = C:/xampp/htdocs
```

**What this does:**
- Server generates patch ‚Üí automatically copies to `C:\xampp\htdocs\patches\patch-Z.MPQ`
- Server updates `C:\xampp\htdocs\patches\version.txt` with timestamp

### Step 4: Create Symlink for Latest Patch

**Location:** `C:\xampp\htdocs\patches\latest\patch-Z.MPQ`

**What to do:**
```powershell
# Create symlink (run as Administrator)
cmd /c mklink "C:\xampp\htdocs\patches\latest\patch-Z.MPQ" "C:\xampp\htdocs\patches\patch-Z.MPQ"
```

**Or manually copy:**
```powershell
# Copy patch to latest folder
Copy-Item "C:\xampp\htdocs\patches\patch-Z.MPQ" -Destination "C:\xampp\htdocs\patches\latest\patch-Z.MPQ" -Force
```

### Step 5: Create .htaccess for MPQ Files

**Location:** `C:\xampp\htdocs\patches\.htaccess`

**Content:**
```apache
# Allow MPQ files
AddType application/octet-stream .MPQ
AddType application/octet-stream .mpq

# Enable directory listing (optional)
Options +Indexes
```

**What to do:**
```powershell
@"
# Allow MPQ files
AddType application/octet-stream .MPQ
AddType application/octet-stream .mpq

# Enable directory listing (optional)
Options +Indexes
"@ | Out-File -FilePath "C:\xampp\htdocs\patches\.htaccess" -Encoding ASCII
```

## ‚úÖ Verification

### Test URLs

Open these in your browser to verify:

1. **Game Folder:**
   ```
   http://localhost/WoW/
   ```
   Should: Show directory listing or download files

2. **Game Executable:**
   ```
   http://localhost/WoW/Wow.exe
   ```
   Should: Download the executable

3. **Patch Version:**
   ```
   http://localhost/patches/version.txt
   ```
   Should: Show a number (timestamp)

4. **Patch Download:**
   ```
   http://localhost/patches/latest/patch-Z.MPQ
   ```
   Should: Download the MPQ file

### Test with PowerShell

```powershell
# Test game folder
Invoke-WebRequest -Uri "http://localhost/WoW/Wow.exe" -Method Head

# Test patch version
Invoke-WebRequest -Uri "http://localhost/patches/version.txt"

# Test patch download
Invoke-WebRequest -Uri "http://localhost/patches/latest/patch-Z.MPQ" -Method Head
```

## üîÑ Auto-Update Process

### How It Works:

1. **Server generates patch:**
   - Server creates `patches/patch-Z.MPQ`
   - Server copies to `C:\xampp\htdocs\patches\patch-Z.MPQ`
   - Server updates `C:\xampp\htdocs\patches\version.txt`

2. **Launcher checks for updates:**
   - Launcher reads `http://localhost/patches/version.txt`
   - Compares with local version
   - Downloads if newer

3. **Launcher downloads game (if needed):**
   - Downloads files from `http://localhost/WoW/`
   - Copies to local `WoW/` folder
   - Much faster than ZIP extraction!

4. **Launcher downloads patch:**
   - Downloads from `http://localhost/patches/latest/patch-Z.MPQ`
   - Saves to `WoW/Data/patch-Z.MPQ`

## üìã Complete Setup Script

Run this PowerShell script to set everything up:

```powershell
# Setup Web Server for WoW Launcher
$xamppPath = "C:\xampp"
$htdocsPath = "$xamppPath\htdocs"
$patchesPath = "$htdocsPath\patches"
$latestPath = "$patchesPath\latest"

# Create directories
New-Item -ItemType Directory -Path $patchesPath -Force | Out-Null
New-Item -ItemType Directory -Path $latestPath -Force | Out-Null

# Create .htaccess
$htaccessContent = @"
# Allow MPQ files
AddType application/octet-stream .MPQ
AddType application/octet-stream .mpq
Options +Indexes
"@
Set-Content -Path "$patchesPath\.htaccess" -Value $htaccessContent

# Check for extracted game folder
if (Test-Path "$htdocsPath\WoW\Wow.exe") {
    Write-Host "‚úì Extracted game folder found" -ForegroundColor Green
} else {
    Write-Host "‚ö† Game folder not found. Run: .\tools\extract_game_to_htdocs.ps1" -ForegroundColor Yellow
}

# Check for patch
if (Test-Path "$patchesPath\patch-Z.MPQ") {
    Write-Host "‚úì Patch file found" -ForegroundColor Green
    
    # Create symlink for latest
    $latestPatch = "$latestPath\patch-Z.MPQ"
    if (-not (Test-Path $latestPatch)) {
        cmd /c mklink "$latestPatch" "$patchesPath\patch-Z.MPQ" 2>&1 | Out-Null
        if (Test-Path $latestPatch) {
            Write-Host "‚úì Created symlink for latest patch" -ForegroundColor Green
        } else {
            # Fallback: copy file
            Copy-Item "$patchesPath\patch-Z.MPQ" -Destination $latestPatch -Force
            Write-Host "‚úì Copied patch to latest folder" -ForegroundColor Green
        }
    }
} else {
    Write-Host "‚ö† Patch file not found. Server will generate it on startup." -ForegroundColor Yellow
}

Write-Host "`n‚úì Web server setup complete!" -ForegroundColor Green
Write-Host "`nTest URLs:" -ForegroundColor Cyan
Write-Host "  Game ZIP: http://localhost/WOTLKHD.zip" -ForegroundColor White
Write-Host "  Patch Version: http://localhost/patches/version.txt" -ForegroundColor White
Write-Host "  Patch Download: http://localhost/patches/latest/patch-Z.MPQ" -ForegroundColor White
```

## üåê Remote Server Setup

If your server is on a different machine:

1. **Update launcher config:**
   ```json
   {
       "server_url": "http://your-server-ip",
       "game_zip_url": "http://your-server-ip/WOTLKHD.zip",
       "patch_version_url": "http://your-server-ip/patches/version.txt",
       "patch_download_url": "http://your-server-ip/patches/latest/patch-Z.MPQ"
   }
   ```

2. **Configure firewall:**
   - Allow port 80 (HTTP) or 443 (HTTPS)
   - Allow access to XAMPP/Apache

3. **Test from client:**
   ```powershell
   Invoke-WebRequest -Uri "http://your-server-ip/patches/version.txt"
   ```

## üîí Security Notes

- **For production:** Use HTTPS instead of HTTP
- **For public servers:** Consider authentication
- **File size:** Game ZIP can be large (several GB) - ensure sufficient bandwidth

## ‚úÖ Final Checklist

- [ ] Game extracted to `C:\xampp\htdocs\WoW\` (run `extract_game_to_htdocs.ps1`)
- [ ] `Wow.exe` exists in `C:\xampp\htdocs\WoW\`
- [ ] Patches directory created
- [ ] Server configured to copy patches (`ProgressiveSystems.DBC.WebServerPath`)
- [ ] Symlink/copy for latest patch
- [ ] `.htaccess` file created
- [ ] Apache/XAMPP running
- [ ] All URLs accessible in browser
- [ ] Launcher config points to correct URLs

## üéâ That's It!

Once setup is complete:
1. Server auto-generates patches ‚Üí copies to web server
2. Launcher checks for updates ‚Üí downloads automatically
3. Players just click "Launch" ‚Üí everything works!

